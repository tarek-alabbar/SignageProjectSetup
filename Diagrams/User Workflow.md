[![](https://mermaid.ink/img/pako:eNqVV91O4zgUfpWjXIxAW1oKbaHRCKlQZpZZfjKUbqUVN27iNhZJnLGdlg7iIfYJ9mYfcB9hj-2kTdoU7XKBKOfH53znO5_dN8fnAXVcR9IfGU18OmRkLkj8nAD-pEQo5rOUJArGQCT889eff8NYUrFrn2j7IyU-_kmnkim66zPQPs376ycYeDe75qE2j77fwpAoMiWyJsOldrmM-BRGigsyr3HxtIs3GYAXkVVRqf19zxUFvqACxg3PhXbT9IJVz5lUgijGE_gEt3zOEhswPrq4mLhwTxZsTjBWcViWm5tY-5DJFA-DSEdiMUVZefh1ovAUGhMWYfqUSLnkIthkGLjgPYyeoEVS1iKZClvRpoQBOgxd-J1ELNAl-IIGNFGMRNI6DI9sCtPKjGdJsAnEf3-lCRU68NvkCet_oeu8trhHqjKRWAv8ApnOwpIZrzSowaa5D3YYcZ9ElQFMdLaxzhYwQZEDiFRAZDjlpOi0dgQnOII04iSAO4wke1E3VrhlU0HEquI1opE-j8VYS2vBAsphxiK6B91Y52ll5sjPU9G6OIizSDHNn9aMi_gIMSaHFQDXyOu0cKBWKW2AZD9pye3SLdowTljwVHNUliG6zOeUA24cxo-3lSmPyIKCqREQxTVJihFf8WTGRAwS3WqnaENjqojuozqagqQy830qJc5ahVk8TZCVHwzotAlDumA-BY8wwZJ5BfyriPkv8OwMgiB3e3b2IB8Ys2ylmKaeoL2jgM2ZAq1Iu6jYeFgyFRoPOGh3Y-QifU2ZWB3-T6BS20zprG2YzBmoBxIXrtiZTe9elZ6pkZrNOD3rsm4tL348vhkWDva0UciXiJ9VCFOMUzkxP8vad4v2tlG2hbRQhdkCDzYUf9P-jbyGccaC9z3Kojv-BBFLXkqVFpDmLNA10KCEKVY3WjMq73NHo3I8rIyUrFZJolUtKJ45quDrLNN-Tj1VJw1sJL92IOVRpGHCfYYs1a3JCie_XlcpCQcUc6zgBCT1DyvYXIUU-Z13JRVRmaxFJcGCd5CZaFHQxwdFhgivmSrbTKu5lSdYNv1gFztNuBJUj2rkhzTIIrpXLwsHWV1XG53QJZKsJkOupbaeikUvuBUXRDiWdg0Vi7eg3RBRVgsob3JhQr6YZP91dYueNIE0qjVI5lz5AMNuE7xMhptkCFb5oTDImcrmCYkeIdW-CVdsxnzzPjAb9ezclyAEskANJdNoLX7eFtHyrSwCWm_ZzhZ-ocoPwewt3RpOgcyoFrdiCXNhWxf1bfRwX1k-jwi5nTo3WZr7RNvsmMsIRpyn8AWXCR93YYkF1lqkwStwyJeJuQStz-YaXl9_eNbd2gYHpUv7sJpNF6XL0a-NmySgrzQYXloXmlQeFN6ObqNW4jOwVrq3yNBr5rOHXym-AKZIq1LL10YVuoC3TLbWkI9UNyySWNndCG4D_EwIrMo037CLo0icvm-S5jywigERkWqrppolKUdb0B5-qwVpj1JK3BmZ605F3vYoZYWx3zMNT6GhRhBqqq4KpSxJYLHWD_Z4NoM1fvAZ2scadyBzXrPmcz3XlrkcTNFOw5kLFjiuEhltODEV-NbGj86bDn52VEhjXE4X_wyIeNFr-o4x-HXhD87jIkzwbB467gzvJfxkb47869DaBXGl4gof2cpx-_2OyeG4b86r43bOm-3u6cl5p3Pc73X7nX7DWTlur9c86bfxv-f9s_OzXv-94fw0Z542z_onx53jXhd_tXuYCrmB9-Od_T5mvpa9_wuSFju4?type=png)](https://mermaid.live/edit#pako:eNqVV91O4zgUfpWjXIxAW1oKbaHRCKlQZpZZfjKUbqUVN27iNhZJnLGdlg7iIfYJ9mYfcB9hj-2kTdoU7XKBKOfH53znO5_dN8fnAXVcR9IfGU18OmRkLkj8nAD-pEQo5rOUJArGQCT889eff8NYUrFrn2j7IyU-_kmnkim66zPQPs376ycYeDe75qE2j77fwpAoMiWyJsOldrmM-BRGigsyr3HxtIs3GYAXkVVRqf19zxUFvqACxg3PhXbT9IJVz5lUgijGE_gEt3zOEhswPrq4mLhwTxZsTjBWcViWm5tY-5DJFA-DSEdiMUVZefh1ovAUGhMWYfqUSLnkIthkGLjgPYyeoEVS1iKZClvRpoQBOgxd-J1ELNAl-IIGNFGMRNI6DI9sCtPKjGdJsAnEf3-lCRU68NvkCet_oeu8trhHqjKRWAv8ApnOwpIZrzSowaa5D3YYcZ9ElQFMdLaxzhYwQZEDiFRAZDjlpOi0dgQnOII04iSAO4wke1E3VrhlU0HEquI1opE-j8VYS2vBAsphxiK6B91Y52ll5sjPU9G6OIizSDHNn9aMi_gIMSaHFQDXyOu0cKBWKW2AZD9pye3SLdowTljwVHNUliG6zOeUA24cxo-3lSmPyIKCqREQxTVJihFf8WTGRAwS3WqnaENjqojuozqagqQy830qJc5ahVk8TZCVHwzotAlDumA-BY8wwZJ5BfyriPkv8OwMgiB3e3b2IB8Ys2ylmKaeoL2jgM2ZAq1Iu6jYeFgyFRoPOGh3Y-QifU2ZWB3-T6BS20zprG2YzBmoBxIXrtiZTe9elZ6pkZrNOD3rsm4tL348vhkWDva0UciXiJ9VCFOMUzkxP8vad4v2tlG2hbRQhdkCDzYUf9P-jbyGccaC9z3Kojv-BBFLXkqVFpDmLNA10KCEKVY3WjMq73NHo3I8rIyUrFZJolUtKJ45quDrLNN-Tj1VJw1sJL92IOVRpGHCfYYs1a3JCie_XlcpCQcUc6zgBCT1DyvYXIUU-Z13JRVRmaxFJcGCd5CZaFHQxwdFhgivmSrbTKu5lSdYNv1gFztNuBJUj2rkhzTIIrpXLwsHWV1XG53QJZKsJkOupbaeikUvuBUXRDiWdg0Vi7eg3RBRVgsob3JhQr6YZP91dYueNIE0qjVI5lz5AMNuE7xMhptkCFb5oTDImcrmCYkeIdW-CVdsxnzzPjAb9ezclyAEskANJdNoLX7eFtHyrSwCWm_ZzhZ-ocoPwewt3RpOgcyoFrdiCXNhWxf1bfRwX1k-jwi5nTo3WZr7RNvsmMsIRpyn8AWXCR93YYkF1lqkwStwyJeJuQStz-YaXl9_eNbd2gYHpUv7sJpNF6XL0a-NmySgrzQYXloXmlQeFN6ObqNW4jOwVrq3yNBr5rOHXym-AKZIq1LL10YVuoC3TLbWkI9UNyySWNndCG4D_EwIrMo037CLo0icvm-S5jywigERkWqrppolKUdb0B5-qwVpj1JK3BmZ605F3vYoZYWx3zMNT6GhRhBqqq4KpSxJYLHWD_Z4NoM1fvAZ2scadyBzXrPmcz3XlrkcTNFOw5kLFjiuEhltODEV-NbGj86bDn52VEhjXE4X_wyIeNFr-o4x-HXhD87jIkzwbB467gzvJfxkb47869DaBXGl4gof2cpx-_2OyeG4b86r43bOm-3u6cl5p3Pc73X7nX7DWTlur9c86bfxv-f9s_OzXv-94fw0Z542z_onx53jXhd_tXuYCrmB9-Od_T5mvpa9_wuSFju4)

**Mermaid code:**

```
sequenceDiagram
    participant U as ðŸ‘¤ User
    participant W as React Website
    participant A as .NET API
    participant D as SQL Database
    participant B as Blob Storage
    participant P as PWA Player

    Note over U,P: 1. User Registration & Login
    U->>W: Navigate to website
    W->>W: Display login page
    U->>W: Enter email & password
    W->>A: POST /api/auth/login
    A->>D: Validate credentials
    D-->>A: User found
    A->>A: Generate JWT token
    A-->>W: Return token + user info
    W->>W: Store token in localStorage
    W-->>U: Redirect to dashboard

    Note over U,P: 2. Upload Media
    U->>W: Navigate to Media Library
    U->>W: Select image/video file
    W->>A: POST /api/media/upload<br/>(multipart/form-data)
    A->>A: Validate file (type, size)
    A->>B: Upload file to blob storage
    B-->>A: Return blob URL
    A->>D: Save media record
    D-->>A: Confirm save
    A-->>W: Return media metadata
    W-->>U: Display success + thumbnail

    Note over U,P: 3. Device Pairing
    U->>W: Click "Add Device"
    W->>A: POST /api/devices/pair
    A->>A: Generate 6-digit code
    A->>D: Save device with code (15min expiry)
    D-->>A: Confirm save
    A-->>W: Return pairing code
    W-->>U: Display code on screen

    U->>P: Navigate to player URL
    P->>P: Generate device UUID
    P-->>U: Show "Enter code" screen
    U->>P: Enter pairing code
    P->>A: POST /api/player/activate<br/>{code, deviceUuid}
    A->>D: Validate code & link UUID
    D-->>A: Device paired
    A-->>P: Success + device credentials
    P->>P: Store credentials locally
    P-->>U: Show "Paired successfully"

    Note over W,D: Website polling for updates
    W->>A: GET /api/devices (every 2 sec)
    A->>D: Check device status
    D-->>A: Device now paired
    A-->>W: Updated device list
    W-->>U: Show device online

    Note over U,P: 4. Create Schedule
    U->>W: Navigate to Schedules
    U->>W: Create new schedule
    U->>W: Select device
    U->>W: Add media items with times
    W->>A: POST /api/schedules
    A->>D: Save schedule + items
    D-->>A: Confirm save
    A-->>W: Schedule created
    W-->>U: Show success

    Note over U,P: 5. Push Schedule to Player
    A->>P: SignalR push notification<br/>"New schedule available"
    P->>A: GET /api/player/schedule/{uuid}
    A->>D: Fetch active schedule
    D-->>A: Schedule + items
    A-->>P: Return schedule JSON
    P->>P: Parse schedule
    P->>P: Check cached media

    loop For each media item
        P->>B: Download media file
        B-->>P: Media file (image/video)
        P->>P: Cache in IndexedDB
    end

    P-->>U: Display content on screen

    Note over U,P: 6. Player Heartbeat
    loop Every 5 minutes
        P->>A: POST /api/player/heartbeat<br/>{deviceUuid, currentMedia, timestamp}
        A->>D: Update lastHeartbeat
        D-->>A: Confirm
        A-->>P: OK
    end

    Note over W,D: Website shows online status
    W->>A: GET /api/devices
    A->>D: Query devices with lastHeartbeat
    D-->>A: Devices list
    A-->>W: Online if heartbeat < 10 min ago
    W-->>U: Show green/red status
```
